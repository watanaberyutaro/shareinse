{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 6, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 70, "column": 0}, "map": {"version":3,"sources":["file:///Users/watanaberyuutarou/Desktop/3125%E6%98%A0%E5%83%8F/myProject/shareinse/assign-management/lib/supabase/server.ts"],"sourcesContent":["import { createServerClient } from '@supabase/ssr'\nimport { cookies } from 'next/headers'\nimport type { Database } from '@/types/database'\n\nexport async function createClient() {\n  const cookieStore = await cookies()\n\n  return createServerClient<Database>(\n    process.env.NEXT_PUBLIC_SUPABASE_URL!,\n    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,\n    {\n      cookies: {\n        getAll() {\n          return cookieStore.getAll()\n        },\n        setAll(cookiesToSet) {\n          try {\n            cookiesToSet.forEach(({ name, value, options }) =>\n              cookieStore.set(name, value, options)\n            )\n          } catch {\n            // サーバーコンポーネントでは cookie の設定が失敗する場合がある\n          }\n        },\n      },\n    }\n  )\n}"],"names":[],"mappings":";;;AAAA;AAAA;AACA;;;AAGO,eAAe;IACpB,MAAM,cAAc,MAAM,CAAA,GAAA,+HAAA,CAAA,UAAO,AAAD;IAEhC,OAAO,CAAA,GAAA,yKAAA,CAAA,qBAAkB,AAAD,sUAGtB;QACE,SAAS;YACP;gBACE,OAAO,YAAY,MAAM;YAC3B;YACA,QAAO,YAAY;gBACjB,IAAI;oBACF,aAAa,OAAO,CAAC,CAAC,EAAE,IAAI,EAAE,KAAK,EAAE,OAAO,EAAE,GAC5C,YAAY,GAAG,CAAC,MAAM,OAAO;gBAEjC,EAAE,OAAM;gBACN,qCAAqC;gBACvC;YACF;QACF;IACF;AAEJ","debugId":null}},
    {"offset": {"line": 99, "column": 0}, "map": {"version":3,"sources":["file:///Users/watanaberyuutarou/Desktop/3125%E6%98%A0%E5%83%8F/myProject/shareinse/assign-management/app/%28protected%29/dashboard/DashboardClient.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/(protected)/dashboard/DashboardClient.tsx <module evaluation> from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/(protected)/dashboard/DashboardClient.tsx <module evaluation>\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,6OAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAAiT,GAC9U,+EACA","debugId":null}},
    {"offset": {"line": 111, "column": 0}, "map": {"version":3,"sources":["file:///Users/watanaberyuutarou/Desktop/3125%E6%98%A0%E5%83%8F/myProject/shareinse/assign-management/app/%28protected%29/dashboard/DashboardClient.tsx/proxy.mjs"],"sourcesContent":["import { registerClientReference } from \"react-server-dom-turbopack/server\";\nexport default registerClientReference(\n    function() { throw new Error(\"Attempted to call the default export of [project]/app/(protected)/dashboard/DashboardClient.tsx from the server, but it's on the client. It's not possible to invoke a client function from the server, it can only be rendered as a Component or passed to props of a Client Component.\"); },\n    \"[project]/app/(protected)/dashboard/DashboardClient.tsx\",\n    \"default\",\n);\n"],"names":[],"mappings":";;;AAAA;;uCACe,CAAA,GAAA,6OAAA,CAAA,0BAAuB,AAAD,EACjC;IAAa,MAAM,IAAI,MAAM;AAA6R,GAC1T,2DACA","debugId":null}},
    {"offset": {"line": 123, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"","debugId":null}},
    {"offset": {"line": 131, "column": 0}, "map": {"version":3,"sources":["file:///Users/watanaberyuutarou/Desktop/3125%E6%98%A0%E5%83%8F/myProject/shareinse/assign-management/app/%28protected%29/dashboard/page.tsx"],"sourcesContent":["import { createClient } from '@/lib/supabase/server'\nimport { redirect } from 'next/navigation'\nimport DashboardClient from './DashboardClient'\n\nexport default async function DashboardPage() {\n  const supabase = await createClient()\n  \n  const { data: { user } } = await supabase.auth.getUser()\n  \n  if (!user) {\n    redirect('/login')\n  }\n\n  // ユーザープロファイルを取得\n  const { data: profile } = await supabase\n    .from('profiles')\n    .select('*, departments(name)')\n    .eq('id', user.id)\n    .single()\n\n  // 当月のデータを取得\n  const currentDate = new Date()\n  const currentMonth = currentDate.toISOString().slice(0, 7) + '-01'\n\n  // アサインデータから個人の売上を集計\n  const { data: userAssignments } = await supabase\n    .from('assignments')\n    .select('*')\n    .eq('work_month', currentMonth)\n    .or(`project_manager_id.eq.${user.id},staff_manager_id.eq.${user.id}`)\n\n  // 個人の売上・利益を計算\n  let salesData = {\n    total_sales: 0,\n    total_profit: 0,\n    project_profit: 0,\n    staff_profit: 0,\n    assignment_count: 0,\n    gross_margin_rate: 0\n  }\n\n  if (userAssignments) {\n    userAssignments.forEach(assignment => {\n      const workDays = assignment.project_type === 'continuous' \n        ? (assignment.work_days || 0)\n        : (assignment.work_dates?.length || 0)\n      \n      const sales = assignment.daily_rate * workDays\n      const cost = assignment.cost_rate * workDays\n      const profit = sales - cost\n      \n      const isProjectManager = assignment.project_manager_id === user.id\n      const isStaffManager = assignment.staff_manager_id === user.id\n      \n      // 売上の配分計算\n      if (isProjectManager && isStaffManager) {\n        // 両方担当の場合: 売上100%、利益100%\n        salesData.total_sales += sales\n        salesData.project_profit += profit * 0.5\n        salesData.staff_profit += profit * 0.5\n        salesData.assignment_count++\n      } else if (isProjectManager) {\n        // 案件担当者のみ: 売上50%、利益50%\n        salesData.total_sales += sales * 0.5\n        salesData.project_profit += profit * 0.5\n        salesData.assignment_count++\n      } else if (isStaffManager) {\n        // 人材担当者のみ: 売上50%、利益50%\n        salesData.total_sales += sales * 0.5\n        salesData.staff_profit += profit * 0.5\n        salesData.assignment_count++\n      }\n    })\n    \n    salesData.total_profit = salesData.project_profit + salesData.staff_profit\n    salesData.gross_margin_rate = salesData.total_sales > 0 \n      ? Math.round((salesData.total_profit / salesData.total_sales) * 100)\n      : 0\n  }\n\n  // 全社データ（管理者・隊長のみ）\n  let companyData = null\n  if (profile?.role === 'admin' || profile?.role === 'leader') {\n    const { data: allAssignments } = await supabase\n      .from('assignments')\n      .select('*')\n      .eq('work_month', currentMonth)\n    \n    if (allAssignments) {\n      let totalSales = 0\n      let totalCost = 0\n      \n      allAssignments.forEach(assignment => {\n        const workDays = assignment.project_type === 'continuous' \n          ? (assignment.work_days || 0)\n          : (assignment.work_dates?.length || 0)\n        \n        totalSales += assignment.daily_rate * workDays\n        totalCost += assignment.cost_rate * workDays\n      })\n      \n      companyData = {\n        totalSales,\n        totalProfit: totalSales - totalCost,\n        totalAssignments: allAssignments.length,\n      }\n    }\n  }\n\n  // 最近のアサインを取得\n  const { data: recentAssignments } = await supabase\n    .from('assignments')\n    .select(`\n      *,\n      project_manager:profiles!assignments_project_manager_id_fkey(display_name),\n      staff_manager:profiles!assignments_staff_manager_id_fkey(display_name)\n    `)\n    .or(`project_manager_id.eq.${user.id},staff_manager_id.eq.${user.id}`)\n    .order('created_at', { ascending: false })\n    .limit(5)\n\n  // 過去6ヶ月の月次データを取得\n  const monthlyData = []\n  for (let i = 5; i >= 0; i--) {\n    const targetDate = new Date()\n    targetDate.setMonth(targetDate.getMonth() - i)\n    const targetMonth = targetDate.toISOString().slice(0, 7) + '-01'\n    \n    const { data: monthAssignments } = await supabase\n      .from('assignments')\n      .select('*')\n      .eq('work_month', targetMonth)\n      .or(`project_manager_id.eq.${user.id},staff_manager_id.eq.${user.id}`)\n    \n    let monthSales = 0\n    let monthProfit = 0\n    \n    if (monthAssignments) {\n      monthAssignments.forEach(assignment => {\n        const workDays = assignment.project_type === 'continuous' \n          ? (assignment.work_days || 0)\n          : (assignment.work_dates?.length || 0)\n        \n        const sales = assignment.daily_rate * workDays\n        const cost = assignment.cost_rate * workDays\n        const profit = sales - cost\n        \n        const isProjectManager = assignment.project_manager_id === user.id\n        const isStaffManager = assignment.staff_manager_id === user.id\n        \n        // 売上と利益の配分計算\n        if (isProjectManager && isStaffManager) {\n          // 両方担当: 売上100%、利益100%\n          monthSales += sales\n          monthProfit += profit\n        } else if (isProjectManager) {\n          // 案件担当のみ: 売上50%、利益50%\n          monthSales += sales * 0.5\n          monthProfit += profit * 0.5\n        } else if (isStaffManager) {\n          // 人材担当のみ: 売上50%、利益50%\n          monthSales += sales * 0.5\n          monthProfit += profit * 0.5\n        }\n      })\n    }\n    \n    monthlyData.push({\n      month: targetDate.toLocaleDateString('ja-JP', { month: 'long' }).replace('月', '月'),\n      sales: monthSales,\n      profit: monthProfit\n    })\n  }\n\n  return (\n    <DashboardClient\n      profile={profile}\n      salesData={salesData}\n      companyData={companyData}\n      recentAssignments={recentAssignments || []}\n      monthlyData={monthlyData}\n    />\n  )\n}"],"names":[],"mappings":"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","debugId":null}}]
}