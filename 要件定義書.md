# 営業管理システム要件定義書

## 1. システム概要

### 1.1 システム名
アサイン管理システム

### 1.2 システムの目的
営業スタッフの月毎の売上・利益を可視化し、個人および会社全体の営業成績を管理・分析できるシステムを構築する。

### 1.3 対象ユーザー
- 営業職のメンバー（営業一番隊、営業二番隊、営業三番隊）
- 各隊の隊長
- 管理者

### 1.4 システム構成
- フロントエンド：Webアプリケーション
- バックエンド：API サーバー
- データベース：PostgreSQL（Supabase）
- 認証：Supabase Auth

## 2. 機能要件

### 2.1 認証機能

#### 2.1.1 ログイン機能
- **認証方式**：Supabase Authを使用
- **ログイン方法**：
  - メールアドレス + パスワード
  - ソーシャルログイン（Google、Microsoft）※オプション
- **セッション管理**：自動ログアウト機能（一定時間操作なしの場合）
- **パスワードリセット**：メールによるパスワードリセット機能

#### 2.1.2 ユーザー権限管理
| 権限レベル | 説明 | できること |
|-----------|------|-----------|
| 管理者 | システム全体の管理者 | - 全データの閲覧・編集<br>- ユーザー管理<br>- 部署管理<br>- 目標値設定 |
| 隊長 | 各営業隊の隊長 | - 全データの閲覧・編集<br>- 所属隊員の管理 |
| 一般 | 営業職メンバー | - 自分が関わるデータの閲覧<br>- 自分が登録したデータの編集 |

#### 2.1.3 部署分類
- 営業一番隊
- 営業一番隊隊長
- 営業二番隊
- 営業二番隊隊長
- 営業三番隊
- 営業三番隊隊長
- 管理者

### 2.2 アサイン管理機能

#### 2.2.1 アサイン情報登録
**登録項目**：
- **基本情報**
  - 案件名（必須）
  - 案件場所（必須）
  - 案件種別（スポット/継続）（必須）
  
- **スタッフ情報**
  - 稼働スタッフ名（必須）
  - 稼働スタッフ所属会社

- **企業情報**
  - 案件元企業名（必須）
  - 人財元企業名（必須）

- **金額情報**
  - 稼働単価（円/日）（必須）
  - 卸単価（円/日）（必須）

- **稼働情報**
  - スポットの場合：カレンダーから日付を複数選択
  - 継続の場合：月の稼働日数を入力

- **担当者情報**
  - 案件担当者（営業スタッフをプルダウンから選択）（必須）
  - 人材担当者（営業スタッフをプルダウンから選択）（必須）

#### 2.2.2 アサイン情報編集
- 登録者本人または管理者/隊長のみ編集可能
- 編集履歴の保存（誰がいつ編集したか）

#### 2.2.3 アサイン情報削除
- 登録者本人または管理者/隊長のみ削除可能
- 物理削除を実施

#### 2.2.4 アサイン情報一覧表示
- ページネーション機能
- 検索機能（案件名、スタッフ名、企業名）
- フィルタ機能（期間、案件種別、担当者）
- ソート機能（登録日、案件名、金額等）

### 2.3 マイページ機能

#### 2.3.1 プロフィール管理
- アイコン画像のアップロード・編集
- 表示名の編集
- 所属部署の表示（編集は管理者のみ）
- メールアドレスの変更
- パスワードの変更

#### 2.3.2 個人売上・利益表示
- **月次サマリー**
  - 当月売上合計
  - 当月利益合計（案件担当分 + 人材担当分）
  - 目標達成率
  
- **売上・利益の内訳**
  - 案件担当として獲得した利益
  - 人材担当として獲得した利益
  - 各案件の詳細（案件名、稼働日数、売上、利益）

- **グラフ表示**
  - 月次売上推移（過去12ヶ月）
  - 利益推移グラフ

### 2.4 ダッシュボード機能

#### 2.4.1 KPI表示
- **全社KPI**（管理者・隊長のみ）
  - 総稼働スタッフ数
  - 全社粗利率
  - 平均稼働率
  - 総案件アサイン数

- **部署別KPI**（所属部署のみ表示）
  - 部署別稼働スタッフ数
  - 部署別粗利率
  - 部署別稼働率
  - 部署別案件数

- **個人KPI**
  - 自分の担当案件数
  - 個人粗利率
  - 目標達成率

#### 2.4.2 グラフ表示
- **売上グラフ**
  - 月次売上推移（棒グラフ）
  - 前年同月比較（折れ線グラフ）

- **利益グラフ**
  - 粗利率推移（折れ線グラフ）
  - 部署別利益構成（円グラフ）

- **稼働率グラフ**
  - 月次稼働率推移（エリアチャート）

#### 2.4.3 更新機能
- 手動更新ボタンによるデータ最新化
- 最終更新日時の表示

### 2.5 レポート・分析機能

#### 2.5.1 分析軸
- **期間別分析**
  - 月単位での集計
  - 四半期集計
  - 年次集計

- **顧客別分析**
  - 案件元企業別売上・利益
  - 人財元企業別売上・利益
  - 取引額ランキング

- **営業担当者別分析**
  - 個人別売上・利益
  - チーム別売上・利益
  - 成績ランキング

#### 2.5.2 レポート機能
- **表示項目**
  - 売上・利益サマリー
  - 詳細データテーブル
  - グラフィカルレポート

- **エクスポート機能**
  - CSV形式でのダウンロード
  - PDF形式でのダウンロード
  - エクスポート範囲の指定（期間、項目）

### 2.6 コメント・メモ機能

#### 2.6.1 コメント投稿
- 案件ごとにコメント・メモを投稿
- 投稿者名と投稿日時を自動記録
- 最大文字数：1000文字

#### 2.6.2 コメント表示
- 全ユーザーがコメントを閲覧可能
- 時系列での表示（新しい順）
- ページネーション（10件ずつ表示）

#### 2.6.3 コメント編集・削除
- 投稿者本人のみ編集・削除可能
- 編集済みマークの表示

### 2.7 目標管理機能（管理者のみ）

#### 2.7.1 目標値設定
- **設定レベル**
  - 個人別目標値
  - 部署別目標値
  - 全社目標値

- **設定項目**
  - 月次売上目標
  - 月次利益目標
  - 案件獲得数目標

#### 2.7.2 目標管理
- 月単位での目標設定
- 過去の目標値の参照
- 目標値の一括インポート（CSV）

## 3. 売上・利益計算ロジック

### 3.1 基本計算式
```
売上 = 稼働単価 × 稼働日数
原価 = 卸単価 × 稼働日数
粗利益 = 売上 - 原価 = (稼働単価 - 卸単価) × 稼働日数
```

### 3.2 利益配分
```
案件担当者の利益 = 粗利益 × 50%
人材担当者の利益 = 粗利益 × 50%
```

### 3.3 集計ルール
- 月次集計は月末締め
- 稼働実績は稼働日ベースで該当月に計上
- 継続案件は月ごとに稼働日数を登録

## 4. 非機能要件

### 4.1 パフォーマンス要件
- ページ読み込み時間：3秒以内
- API レスポンス時間：1秒以内
- 同時接続ユーザー数：100人以上

### 4.2 セキュリティ要件
- HTTPS通信の使用
- SQLインジェクション対策
- XSS対策
- CSRF対策
- アクセスログの記録

### 4.3 可用性要件
- 稼働率：99%以上（計画メンテナンスを除く）
- バックアップ：日次自動バックアップ
- データ保持期間：3年間

### 4.4 ユーザビリティ要件
- レスポンシブデザイン（PC、タブレット、スマートフォン対応）
- 直感的な操作性
- エラーメッセージの分かりやすさ

### 4.5 互換性要件
- 対応ブラウザ：
  - Chrome（最新版）
  - Firefox（最新版）
  - Safari（最新版）
  - Edge（最新版）

## 5. 画面一覧

| 画面名 | 説明 | 主な機能 |
|--------|------|----------|
| ログイン画面 | システムへのログイン | ログイン、パスワードリセット |
| ダッシュボード | KPIとグラフの表示 | データ可視化、更新 |
| アサイン一覧 | アサイン情報の一覧表示 | 検索、フィルタ、ソート |
| アサイン登録 | 新規アサインの登録 | データ入力、保存 |
| アサイン編集 | 既存アサインの編集 | データ修正、保存 |
| マイページ | 個人情報と売上表示 | プロフィール編集、売上確認 |
| レポート | 分析レポートの表示 | 集計、エクスポート |
| ユーザー管理 | ユーザーの管理（管理者のみ） | ユーザー追加、編集、削除 |
| 目標設定 | 目標値の設定（管理者のみ） | 目標入力、保存 |

## 6. データベース設計概要

### 6.1 主要テーブル
- users（ユーザー）
- departments（部署）
- assignments（アサイン）
- companies（企業）
- comments（コメント）
- targets（目標）
- sales_records（売上記録）

### 6.2 リレーション
- ユーザーは1つの部署に所属
- アサインは案件担当者と人材担当者を持つ
- コメントはアサインに紐づく
- 目標はユーザー/部署/全社に設定可能

## 7. 開発スケジュール（参考）

| フェーズ | 期間 | 内容 |
|----------|------|------|
| 要件定義 | 2週間 | 要件の確定、仕様書作成 |
| 設計 | 3週間 | 画面設計、DB設計、API設計 |
| 開発 | 8週間 | 実装、単体テスト |
| テスト | 2週間 | 結合テスト、受入テスト |
| リリース | 1週間 | 本番環境構築、移行 |

## 8. 今後の検討事項

- モバイルアプリの開発
- 外部システムとの連携（会計システム等）
- AI による売上予測機能
- 通知機能の拡張（Slack、メール通知）
- 多言語対応

---

*本要件定義書は初版であり、詳細設計フェーズで内容を精査・更新する予定です。*

*作成日: 2025年8月16日*
*バージョン: 1.0*